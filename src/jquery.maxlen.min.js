/*
 * Maxlen v 0.1 2011-02-10
 * http://aremesal.net/seccion-maxlen
 *
 * Copyright (c) 2011, Aremesal
 * 
 * Licensed under the MIT license.
 */
(function($){$.fn.maxlen=function(options){var settings={maxChars:10,showMessage:true,strPreText:"You have",strPostText:"available characters remaining",classBase:"jmaxlen",callbackFunc:""};var methods={writeSpan:function(obj,str){obj.next("span."+obj.data("classBase")+"-sp").children("span").html(str)},addErrorClass:function(obj){obj.next("span."+obj.data("classBase")+"-sp").addClass(""+obj.data("classBase")+"-sperror")},removeErrorClass:function(obj){obj.next("span."+obj.data("classBase")+"-sp").removeClass(""+obj.data("classBase")+"-sperror")}};return this.each(function(){var opts=jQuery.extend(settings,options);var th=$(this);if(th.attr("maxlength")!="-1"&&th.attr("maxlength")!=""){opts=jQuery.extend(settings,{maxChars:th.attr("maxlength")})}if(!th.hasClass(opts.classBase+"-txt")){th.data("maxChars",opts.maxChars);th.data("callbackFunc",opts.callbackFunc);th.data("showMessage",opts.showMessage);th.data("classBase",opts.classBase);actualChars=th.data("maxChars")-th.val().length;if(th.data("showMessage")){th.after('<span class="'+th.data("classBase")+'-sp">'+opts.strPreText+" <span>"+actualChars+"</span> "+opts.strPostText+"</span>")}th.addClass(th.data("classBase")+"-txt");th.keypress(function(event){var avail=th.data("maxChars")-$(this).val().length;if(avail<=0){if(event.keyCode<"8"||event.keyCode>"48"||event.keyCode=="13"){if(th.data("callbackFunc")!=""){eval(th.data("callbackFunc"))(th)}event.preventDefault()}}});th.keyup(function(event){var avail=th.data("maxChars")-$(this).val().length;if(avail>=0){methods.writeSpan($(this),avail)}if(avail<=0){methods.addErrorClass($(this))}else{methods.removeErrorClass($(this))}});th.change(function(event){var avail=th.data("maxChars")-$(this).val().length;if(avail<=0){th.val(th.val().substr(0,th.data("maxChars")));methods.writeSpan($(this),"0");methods.addErrorClass($(this))}})}})}})(jQuery);
